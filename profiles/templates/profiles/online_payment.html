{% extends 'profiles/profile_base_layout.html' %}

{% block headcontent %}
<style>
    /* Online Payments Specific Styles */
    .welcome-section {
        background: var(--bg-card);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        padding: 2.5rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .welcome-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-primary);
    }
    
    .welcome-title {
        font-size: 2.25rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .welcome-subtitle {
        font-size: 1.125rem;
        color: var(--text-secondary);
        font-weight: 400;
        margin: 0;
    }

    /* UPI Payment Options Grid */
    .payment-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .payment-card {
        background: var(--bg-card);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        padding: 2rem;
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .payment-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-color);
    }

    .payment-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--gradient-primary);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .payment-card:hover::before {
        transform: scaleX(1);
    }

    .payment-icon {
        font-size: 3rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
        display: block;
    }

    .payment-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .payment-description {
        font-size: 0.95rem;
        color: var(--text-secondary);
        line-height: 1.5;
    }

    /* UPI Form Styles */
    .upi-form-section {
        background: var(--bg-card);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        padding: 2rem;
        margin-bottom: 2rem;
        display: none;
    }

    .upi-form-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .form-input {
        width: 100%;
        padding: 0.875rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        background: var(--bg-input);
        color: var(--text-primary);
        font-size: 1rem;
        transition: var(--transition);
        box-sizing: border-box;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
    }

    /* Fixed Custom Select Dropdown for Both Themes */
    .custom-select-wrapper {
        position: relative;
        display: block;
        width: 100%;
    }

    .custom-select {
        width: 100%;
        padding: 0.875rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        background: var(--bg-input);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: var(--transition);
        box-sizing: border-box;
        min-height: 48px;
    }

    .custom-select:hover,
    .custom-select.active {
        border-color: var(--primary-color);
    }

    .custom-select .selected-text {
        color: var(--text-primary);
        flex: 1;
        text-align: left;
    }

    .custom-select-arrow {
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 5px solid var(--text-primary);
        transition: transform 0.3s ease;
        margin-left: 1rem;
    }

    .custom-select.active .custom-select-arrow {
        transform: rotate(180deg);
    }

    .custom-options {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-input);
        border: 1px solid var(--border-color);
        border-top: none;
        border-radius: 0 0 var(--border-radius) var(--border-radius);
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: var(--shadow-md);
    }

    .custom-options.show {
        display: block;
    }

    .custom-option {
        padding: 0.875rem 1rem;
        color: var(--text-primary);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: var(--bg-input);
        border: none;
    }

    .custom-option:hover {
        background: var(--bg-hover);
        color: var(--primary-color);
    }

    .custom-option.selected {
        background: var(--primary-color);
        color: white;
    }

    .custom-option span {
        font-size: 1.2rem;
        margin-right: 0.5rem;
    }

    /* Light theme fallbacks */
    :root {
        --bg-input-light: #ffffff;
        --bg-hover-light: #f7fafc;
        --text-primary-light: #2d3748;
        --border-color-light: #e2e8f0;
    }

    /* Dark theme fallbacks */
    :root {
        --bg-input-dark: #2d3748;
        --bg-hover-dark: #4a5568;
        --text-primary-dark: #e2e8f0;
        --border-color-dark: #4a5568;
    }

    /* Light theme specific styles */
    @media (prefers-color-scheme: light) {
        .custom-select {
            background: var(--bg-input, #ffffff);
            color: var(--text-primary, #2d3748);
            border-color: var(--border-color, #e2e8f0);
        }
        
        .custom-options {
            background: var(--bg-input, #ffffff);
            border-color: var(--border-color, #e2e8f0);
        }
        
        .custom-option {
            background: var(--bg-input, #ffffff);
            color: var(--text-primary, #2d3748);
        }
        
        .custom-option:hover {
            background: var(--bg-hover, #f7fafc);
        }
    }

    /* Dark theme specific styles */
    @media (prefers-color-scheme: dark) {
        .custom-select {
            background: var(--bg-input, #2d3748);
            color: var(--text-primary, #e2e8f0);
            border-color: var(--border-color, #4a5568);
        }
        
        .custom-options {
            background: var(--bg-input, #2d3748);
            border-color: var(--border-color, #4a5568);
        }
        
        .custom-option {
            background: var(--bg-input, #2d3748);
            color: var(--text-primary, #e2e8f0);
        }
        
        .custom-option:hover {
            background: var(--bg-hover, #4a5568);
        }
    }

    /* Force theme-specific styles when CSS variables might not be available */
    .light-theme .custom-select,
    [data-theme="light"] .custom-select {
        background: #ffffff !important;
        color: #2d3748 !important;
        border-color: #e2e8f0 !important;
    }

    .light-theme .custom-options,
    [data-theme="light"] .custom-options {
        background: #ffffff !important;
        border-color: #e2e8f0 !important;
    }

    .light-theme .custom-option,
    [data-theme="light"] .custom-option {
        background: #ffffff !important;
        color: #2d3748 !important;
    }

    .light-theme .custom-option:hover,
    [data-theme="light"] .custom-option:hover {
        background: #f7fafc !important;
    }

    .dark-theme .custom-select,
    [data-theme="dark"] .custom-select {
        background: #2d3748 !important;
        color: #e2e8f0 !important;
        border-color: #4a5568 !important;
    }

    .dark-theme .custom-options,
    [data-theme="dark"] .custom-options {
        background: #2d3748 !important;
        border-color: #4a5568 !important;
    }

    .dark-theme .custom-option,
    [data-theme="dark"] .custom-option {
        background: #2d3748 !important;
        color: #e2e8f0 !important;
    }

    .dark-theme .custom-option:hover,
    [data-theme="dark"] .custom-option:hover {
        background: #4a5568 !important;
    }

    /* Default fallback for when no theme is detected */
    .custom-select {
        background: var(--bg-input, #ffffff);
        color: var(--text-primary, #2d3748);
    }

    .custom-options {
        background: var(--bg-input, #ffffff);
    }

    .custom-option {
        background: var(--bg-input, #ffffff);
        color: var(--text-primary, #2d3748);
    }

    .btn-primary {
        background: var(--gradient-primary);
        color: white;
        border: none;
        padding: 0.875rem 2rem;
        border-radius: var(--border-radius);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
        padding: 0.875rem 2rem;
        border-radius: var(--border-radius);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        margin-left: 1rem;
    }

    .btn-secondary:hover {
        background: var(--bg-hover);
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    /* Recent Transactions */
    .transactions-section {
        background: var(--bg-card);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .transaction-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        transition: var(--transition);
    }

    .transaction-item:last-child {
        border-bottom: none;
    }

    .transaction-item:hover {
        background: var(--bg-hover);
        border-radius: var(--border-radius);
    }

    .transaction-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .transaction-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary-light);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary-color);
        font-size: 1.2rem;
    }

    .transaction-details h4 {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0 0 0.25rem 0;
    }

    .transaction-details p {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin: 0;
    }

    .transaction-amount {
        font-weight: 600;
        font-size: 1rem;
    }

    .amount-credit {
        color: #10b981;
    }

    .amount-debit {
        color: #ef4444;
    }

    /* QR Code Modal */
    .qr-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .qr-modal.active {
        display: flex;
    }

    .qr-modal-content {
        background: var(--bg-card);
        border-radius: var(--border-radius-lg);
        padding: 2rem;
        text-align: center;
        max-width: 450px;
        width: 95%;
        position: relative;
    }

    .close-modal {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--text-secondary);
        cursor: pointer;
        transition: var(--transition);
    }

    .close-modal:hover {
        color: var(--text-primary);
    }

    /* My QR Code Section */
    .my-qr-section {
        display: block;
    }

    .my-qr-section.hidden {
        display: none;
    }

    .qr-section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    /* Enhanced QR Code with UPI ID */
    .qr-code-container {
        background: var(--bg-card);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        margin: 1rem 0;
        border: 2px solid var(--border-color);
    }

    .upi-id-display {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 1rem;
        margin-bottom: 1rem;
        text-align: center;
    }

    .upi-id-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .upi-id-value {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--primary-color);
        font-family: monospace;
    }

    .qr-code {
        width: 220px;
        height: 220px;
        background: white;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        margin: 1rem auto;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }

    .qr-pattern {
        width: 180px;
        height: 180px;
    }

    .qr-info {
        color: var(--text-secondary);
        font-size: 0.9rem;
        text-align: center;
        margin: 1rem 0;
    }

    .scan-qr-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: var(--border-radius);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        width: 100%;
        justify-content: center;
        margin-top: 1rem;
    }

    .scan-qr-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg);
    }

    /* QR Scanner Section */
    .scanner-section {
        display: none;
    }

    .scanner-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    .qr-scanner {
        width: 220px;
        height: 220px;
        margin: 1rem auto;
        position: relative;
    }

    .scanner-frame {
        width: 100%;
        height: 100%;
        background: #1a1a1a;
        border-radius: var(--border-radius);
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .scanner-overlay {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 20px;
        bottom: 20px;
        border: 2px solid var(--primary-color);
        border-radius: var(--border-radius);
    }

    .scanner-corners {
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
    }

    .corner {
        position: absolute;
        width: 20px;
        height: 20px;
        border: 3px solid var(--primary-color);
    }

    .corner.top-left {
        top: 0;
        left: 0;
        border-right: none;
        border-bottom: none;
    }

    .corner.top-right {
        top: 0;
        right: 0;
        border-left: none;
        border-bottom: none;
    }

    .corner.bottom-left {
        bottom: 0;
        left: 0;
        border-right: none;
        border-top: none;
    }

    .corner.bottom-right {
        bottom: 0;
        right: 0;
        border-left: none;
        border-top: none;
    }

    .scanner-line {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--primary-color);
        animation: scannerMove 2s linear infinite;
        opacity: 0.8;
    }

    @keyframes scannerMove {
        0% { transform: translateY(-100px); }
        100% { transform: translateY(100px); }
    }

    .scanner-text {
        color: #ccc;
        font-size: 0.85rem;
        text-align: center;
        position: absolute;
        bottom: 10px;
        left: 0;
        right: 0;
        margin: 0;
    }

    .scanner-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1rem;
        flex-wrap: wrap;
    }

    .back-btn {
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
        padding: 0.875rem 2rem;
        border-radius: var(--border-radius);
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .back-btn:hover {
        background: var(--bg-hover);
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .welcome-section {
            padding: 2rem;
        }
        
        .welcome-title {
            font-size: 1.875rem;
        }
        
        .payment-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .payment-card {
            padding: 1.5rem;
        }
        
        .transactions-section,
        .upi-form-section {
            padding: 1.5rem;
        }
        
        .transaction-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .transaction-amount {
            align-self: flex-end;
        }
    }

    @media (max-width: 480px) {
        .welcome-section {
            padding: 1.5rem;
        }
        
        .welcome-title {
            font-size: 1.5rem;
        }
        
        .payment-card {
            padding: 1.25rem;
        }
        
        .payment-icon {
            font-size: 2.5rem;
        }
        
        .btn-secondary {
            margin-left: 0;
            margin-top: 0.5rem;
        }

        .qr-modal-content {
            padding: 1.5rem;
        }
        
        .qr-code,
        .qr-scanner {
            width: 180px;
            height: 180px;
        }
        
        .qr-pattern {
            width: 140px;
            height: 140px;
        }
        
        .scanner-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .btn-primary,
        .btn-secondary,
        .scan-qr-btn {
            width: 100%;
            max-width: 200px;
        }
    }
</style>
{% endblock %}

{% block bodycontent %}
<!-- Welcome Section -->
<div class="welcome-section">
    <h1 class="welcome-title">Welcome back, {{ user }}!</h1>
    <p class="welcome-subtitle">Manage your UPI payments securely</p>
</div>

<!-- UPI Payment Options -->
<div class="payment-grid">
    <div class="payment-card" onclick="showQRCode()">
        <i class="fas fa-qrcode payment-icon"></i>
        <h3 class="payment-title">Scan QR Code</h3>
        <p class="payment-description">Generate QR code for quick payments</p>
    </div>
    
    <div class="payment-card" onclick="showUPIForm()">
        <i class="fas fa-at payment-icon"></i>
        <h3 class="payment-title">Pay with UPI ID</h3>
        <p class="payment-description">Send money using UPI ID or VPA</p>
    </div>
    
    <div class="payment-card" onclick="showBillPayment()">
        <i class="fas fa-file-invoice-dollar payment-icon"></i>
        <h3 class="payment-title">Bill Payments</h3>
        <p class="payment-description">Pay utility bills and recharges</p>
    </div>
</div>

<!-- UPI ID Payment Form -->
<div id="upiForm" class="upi-form-section">
    <h3 class="section-title">
        <i class="fas fa-at"></i>
        Pay with UPI ID
    </h3>
    <form method="POST" action="{% url 'profiles:online_pay' %}">
    {% csrf_token %}
        <div class="form-group">
            <label class="form-label">UPI ID / VPA</label>
            <input type="text" class="form-input" name="recipient_upi_id" placeholder="example@finedge" required>
        </div>
        <div class="form-group">
            <label class="form-label">Amount (‚Çπ)</label>
            <input type="number" class="form-input" name="payment_amount" placeholder="0.00" min="1" required>
        </div>
        <div class="form-group">
            <label class="form-label">Description (Optional)</label>
            <input type="text" class="form-input" name="description" placeholder="Payment for...">
        </div>
        <button type="submit" class="btn-primary">
            <i class="fas fa-paper-plane"></i>
            Send Payment
        </button>
        <button type="button" class="btn-secondary" onclick="hideAllForms()">Cancel</button>
    </form>
</div>

<!-- Bill Payment Form with Fixed Custom Dropdown -->
<div id="billForm" class="upi-form-section">
    <h3 class="section-title">
        <i class="fas fa-file-invoice-dollar"></i>
        Bill Payments
    </h3>
    <form>
        <div class="form-group">
            <label class="form-label">Bill Type</label>
            <div class="custom-select-wrapper">
                <div class="custom-select" onclick="toggleCustomSelect(this)">
                    <span class="selected-text">Select Bill Type</span>
                    <div class="custom-select-arrow"></div>
                </div>
                <div class="custom-options">
                    <div class="custom-option" data-value="electricity">
                        <span>‚ö°</span> Electricity
                    </div>
                    <div class="custom-option" data-value="water">
                        <span>üíß</span> Water
                    </div>
                    <div class="custom-option" data-value="gas">
                        <span>üî•</span> Gas
                    </div>
                    <div class="custom-option" data-value="mobile">
                        <span>üì±</span> Mobile Recharge
                    </div>
                    <div class="custom-option" data-value="dth">
                        <span>üì∫</span> DTH Recharge
                    </div>
                    <div class="custom-option" data-value="internet">
                        <span>üåê</span> Internet
                    </div>
                </div>
                <input type="hidden" name="bill_type" id="billTypeInput" required>
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">Bill Number / Account ID</label>
            <input type="text" class="form-input" name="bill_number" placeholder="Enter bill number" required>
        </div>
        <div class="form-group">
            <label class="form-label">Amount (‚Çπ)</label>
            <input type="number" class="form-input" name="bill_amount" placeholder="0.00" min="1" required>
        </div>
        <button type="submit" class="btn-primary">
            <i class="fas fa-credit-card"></i>
            Pay Bill
        </button>
        <button type="button" class="btn-secondary" onclick="hideAllForms()">Cancel</button>
    </form>
</div>

<!-- Recent Transactions -->
<div class="transactions-section">
    <h3 class="section-title">
        <i class="fas fa-history"></i>
        Recent Transactions
    </h3>
    {% for tx in transactions %}
    <div class="transaction-item">
        <div class="transaction-info">
            <div class="transaction-icon">
                <i class="fas {% if tx.transfer_amount < 0 %}fa-arrow-down{% else %}fa-arrow-up{% endif %}"></i>
            </div>
            <div class="transaction-details">
                <h4>{{ tx.recipient_name }}</h4>
                <p>{{ tx.date_of_transfer }} ‚Ä¢ {{ tx.transfer_method }} ‚Ä¢ {{ tx.recipient_account_number }}</p>
            </div>
        </div>
        <div class="transaction-amount {% if tx.transfer_amount < 0 %}amount-debit{% else %}amount-credit{% endif %}">
            ‚Çπ{{ tx.transfer_amount }}
        </div>
    </div>
    {% endfor %}
</div>

<!-- QR Code Modal -->
<div id="qrModal" class="qr-modal">
    <div class="qr-modal-content">
        <button class="close-modal" onclick="hideQRCode()">&times;</button>
        
        <!-- My QR Code Section -->
        <div id="myQRSection" class="my-qr-section">
            <h3 class="qr-section-title">
                <i class="fas fa-qrcode"></i>
                My QR Code
            </h3>
            
            <div class="qr-code-container">
                <!-- UPI ID Display -->
                <div class="upi-id-display">
                    <div class="upi-id-label">Your UPI ID</div>
                    <div class="upi-id-value">{{ user }}@finedge</div>
                </div>
                
                <!-- QR Code -->
                <div class="qr-code">
                    <div class="qr-pattern">
                        <div id="upiQrCode"></div>
                    </div>
                </div>
                
                <p class="qr-info">Share this QR code with others to receive payments</p>
            </div>
            
            <!-- Scan QR Code Button -->
            <button class="scan-qr-btn" onclick="showScanner()">
                <i class="fas fa-camera"></i>
                Scan QR Code
            </button>
        </div>
        
        <!-- Scanner Section -->
        <div id="scannerSection" class="scanner-section">
            <h3 class="qr-section-title">
                <i class="fas fa-camera"></i>
                Scan QR Code
            </h3>
            
            <div class="qr-scanner">
                <div class="scanner-frame">
                    <div class="scanner-overlay">
                        <div class="scanner-corners">
                            <div class="corner top-left"></div>
                            <div class="corner top-right"></div>
                            <div class="corner bottom-left"></div>
                            <div class="corner bottom-right"></div>
                        </div>
                        <div class="scanner-line"></div>
                    </div>
                    <p class="scanner-text">Position QR code within the frame</p>
                </div>
            </div>
            
            <div class="scanner-actions">
                <button class="btn-primary" onclick="startScanning()">
                    <i class="fas fa-camera"></i>
                    Start Camera
                </button>
                <button class="btn-secondary" onclick="uploadQR()">
                    <i class="fas fa-upload"></i>
                    Upload Image
                </button>
                <button class="back-btn" onclick="showMyQR()">
                    <i class="fas fa-arrow-left"></i>
                    Back to My QR
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scriptcontent %}
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Highlight current page in sidebar
        const onlineLink = document.getElementById('online');
        if (onlineLink) {
            document.querySelectorAll('.nav-card').forEach(link => link.classList.remove('current'));
            onlineLink.classList.add('current');
        }

        // Generate QR Code
        const upiId = "{{ user }}@finedge";
        new QRCode(document.getElementById("upiQrCode"), {
            text: upiId,
            width: 180,
            height: 180,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });
    });

    // Custom Select Dropdown Functions
    function toggleCustomSelect(selectElement) {
        const options = selectElement.nextElementSibling;
        const isOpen = options.classList.contains('show');
        
        // Close all other dropdowns
        document.querySelectorAll('.custom-options').forEach(opt => opt.classList.remove('show'));
        document.querySelectorAll('.custom-select').forEach(sel => sel.classList.remove('active'));
        
        if (!isOpen) {
            options.classList.add('show');
            selectElement.classList.add('active');
        }
    }

    // Handle option selection
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('custom-option') || e.target.parentElement.classList.contains('custom-option')) {
            const option = e.target.classList.contains('custom-option') ? e.target : e.target.parentElement;
            const value = option.getAttribute('data-value');
            const text = option.textContent.trim();
            const selectWrapper = option.closest('.custom-select-wrapper');
            const selectElement = selectWrapper.querySelector('.custom-select');
            const selectedText = selectElement.querySelector('.selected-text');
            const hiddenInput = selectWrapper.querySelector('input[type="hidden"]');
            
            // Update display and value
            selectedText.textContent = text;
            hiddenInput.value = value;
            
            // Remove active states
            selectWrapper.querySelectorAll('.custom-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            
            // Close dropdown
            selectWrapper.querySelector('.custom-options').classList.remove('show');
            selectElement.classList.remove('active');
        }
        
        // Close dropdown when clicking outside
        if (!e.target.closest('.custom-select-wrapper')) {
            document.querySelectorAll('.custom-options').forEach(opt => opt.classList.remove('show'));
            document.querySelectorAll('.custom-select').forEach(sel => sel.classList.remove('active'));
        }
    });

    function showUPIForm() {
        hideAllForms();
        document.getElementById('upiForm').classList.add('active');
        document.getElementById('upiForm').scrollIntoView({ behavior: 'smooth' });
    }

    function showBillPayment() {
        hideAllForms();
        document.getElementById('billForm').classList.add('active');
        document.getElementById('billForm').scrollIntoView({ behavior: 'smooth' });
    }

    function hideAllForms() {
        document.querySelectorAll('.upi-form-section').forEach(form => {
            form.classList.remove('active');
        });
    }

    function showQRCode() {
        document.getElementById('qrModal').classList.add('active');
        showMyQR();
    }

    function hideQRCode() {
        document.getElementById('qrModal').classList.remove('active');
    }

    function showMyQR() {
        document.getElementById('myQRSection').classList.remove('hidden');
        document.getElementById('scannerSection').classList.remove('active');
    }

    function showScanner() {
        document.getElementById('myQRSection').classList.add('hidden');
        document.getElementById('scannerSection').classList.add('active');
    }

    function startScanning() {
        const scannerText = document.querySelector('.scanner-text');
        const btn = event.target;
        
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scanning...';
        btn.disabled = true;
        
        scannerText.textContent = 'Scanning for QR codes...';
        
        setTimeout(() => {
            scannerText.textContent = 'QR Code detected! Processing...';
            setTimeout(() => {
                alert('QR Code scanned successfully!\nPayment details will be loaded.');
                btn.innerHTML = '<i class="fas fa-camera"></i> Start Camera';
                btn.disabled = false;
                scannerText.textContent = 'Position QR code within the frame';
                hideQRCode();
            }, 1500);
        }, 3000);
    }

    function uploadQR() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = function() {
            if (this.files[0]) {
                alert('QR Code image uploaded successfully!\nProcessing payment details...');
                hideQRCode();
            }
        };
        input.click();
    }

    // Close modal when clicking outside
    document.getElementById('qrModal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideQRCode();
        }
    });
</script>
{% endblock %}